# ==============================================================================
# SenTient Core Configuration (Butterfly/Jetty)
# ==============================================================================
# This file governs the Java application server, module loading, and 
# orchestration of the hybrid architecture.
# ==============================================================================

# ------------------------------------------------------------------------------
# 1. SERVER IDENTITY & NETWORKING
# ------------------------------------------------------------------------------
# We bind strictly to 127.0.0.1 by default for security (OpenRefine Heritage).
# The port 3333 is the standard entry point for the User Interface.
butterfly.host = 127.0.0.1
butterfly.port = 3333
butterfly.context = /

# Security: Prevent DNS rebinding attacks.
# Only requests with these Host headers are allowed.
refine.host_whitelist = localhost,127.0.0.1

# Cross-Origin Resource Sharing (CORS)
# Essential for decoupling the modern React Frontend (Port 3000) from Jetty.
refine.allow_origins = http://localhost:3000,http://127.0.0.1:3000

# ------------------------------------------------------------------------------
# 2. MODULE LOADER (The Extension Architecture)
# ------------------------------------------------------------------------------
# Butterfly uses a plugin system. We load the 'core' logic + 'extensions'.
# - core: The Refine ProjectManager, History, and Engine.
# - extensions: The Wikibase connector, JDBC drivers, and SenTient adapters.
butterfly.modules.path = modules,extensions

# Auto-reload classes during development (Set to false for Production)
butterfly.autoreload = false

# ------------------------------------------------------------------------------
# 3. ORCHESTRATION WIRING (Connecting the 3 Layers)
# ------------------------------------------------------------------------------
# These properties are read by the 'SenTientOrchestrator' Java class to 
# communicate with the Python and Solr layers.
# [ALIGNMENT] URLs updated to strict 127.0.0.1 to match Golden Variables.

# LAYER 1: Ingestion & Fast Tagging (Tapioca/Solr)
sentient.layer1.solr.url = http://127.0.0.1:8983/solr/sentient-tapioca
sentient.layer1.timeout_ms = 500

# LAYER 2: Semantic Context (Falcon/Python)
# Must match the port defined in 'config/nlp/falcon_settings.yaml'
sentient.layer2.falcon.url = http://127.0.0.1:5005/api/v1
sentient.layer2.timeout_ms = 120000

# ------------------------------------------------------------------------------
# 4. ASYNC PROCESS MANAGER (The Non-Blocking Strategy)
# ------------------------------------------------------------------------------
# Configuration for the LongRunningProcessManager.
# High thread count allows multiple reconciliation jobs to run in background
# without freezing the UI.

# The size of the thread pool for async commands (Reconciliation, Export)
butterfly.thread_pool.core_size = 10
butterfly.thread_pool.max_size = 50

# How long to keep results of a finished job in memory before purging
refine.process.history_retention_minutes = 60

# ------------------------------------------------------------------------------
# 5. DATA & MEMORY STRATEGY
# ------------------------------------------------------------------------------
# Location of the workspace (Project storage, History serialization).
# On Linux/Mac: ~/Library/Application Support/SenTient/
# On Windows: %APPDATA%/SenTient/
refine.data_dir_name = SenTient

# Memory Guard:
# While Heap Size is set via JVM args (-Xmx), we configure the 
# "Checking" interval here to warn users if they approach the limit.
refine.memory.check_interval_seconds = 10
refine.memory.warning_threshold_percentage = 90

# ------------------------------------------------------------------------------
# 6. CACHING STRATEGIES
# ------------------------------------------------------------------------------
# Reconciliation responses are cached to avoid re-querying Solr/Falcon 
# for identical strings (The "Cold Cache" strategy).

# Enable disk-based caching for reconciliation
refine.reconciliation.cache.enabled = true
refine.reconciliation.cache.size_mb = 1024

# ------------------------------------------------------------------------------
# 7. SIDECAR STORAGE (Hybrid Memory Architecture)
# ------------------------------------------------------------------------------
# Configuration for the DuckDB adapter that stores heavy AI vectors on disk.
# Prevents Heap exhaustion during large batch processing.

# The driver class loaded by 'extensions/jdbc/module/lib/duckdb_jdbc.jar'
refine.storage.driver = org.duckdb.DuckDBDriver
refine.storage.mode = WAL
refine.storage.checkpoint_rows = 1000